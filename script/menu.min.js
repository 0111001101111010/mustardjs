var ordrin=ordrin instanceof Object?ordrin:{};(function(){ordrin.hasOwnProperty("template")||(ordrin.template='<div id="yourTray">Your Tray</div><ul class="menuList">{{#menu}}<li class="menuCategory" data-mgid="{{id}}"><div class="menu-hd"><p class="header itemListName">{{name}}</p></div><ul class="itemList menu main-menu">{{#children}}<li class="mi" data-listener="menuItem" data-miid="{{id}}"><p class="name">{{name}}</p><p><span class="price">{{price}}</span></p></li>{{/children}}</ul></li>{{/menu}}</ul><div class="trayContainer"><ul class="tray"></ul></div><!-- Menu Item Dialog --><div class="optionsDialog popup-container hidden"></div><div class="dialogBg fade-to-gray hidden"></div>'),ordrin.hasOwnProperty("dialogTemplate")||(ordrin.dialogTemplate='<div class="popup-box-container dialog"><div class="close-popup-box"><img class="closeDialog" data-listener="closeDialog" src="https://fb.ordr.in/images/popup-close.png" /></div><div class="mItem-add-to-tray popup-content"><div class="menu-hd"><div class="boxright"><h1 class="big-col itemTitle">{{name}}</h1><p class="slim-col itemPrice">{{price}}</p></div><div class="clear"></div></div><p class="desc dialogDescription">{{descrip}}</p></div><div class="optionContainer"><ul class="optionCategoryList">{{#children}}<li data-mogid="{{id}}" class="optionCategory"><span class="header">{{name}}</span><span class="error"></span><ul class="optionList">{{#children}}<li class="option" data-moid="{{id}}"><input type="checkbox" class="optionCheckbox" data-listener="optionCheckbox" /><span class="optionName">{{name}}</span><span class="optionPrice">{{price}}</span></li>{{/children}}</ul><div class="clear"></div></li>{{/children}}</ul>      </div><label for="itemQuantity">Quantity: </label><input type="number" class="itemQuantity" value="1" min="1" /><br /><input type="submit" class="buttonRed" data-listener="addToTray" value="Add to Tray" /></div>'),ordrin.hasOwnProperty("trayItemTemlate")||(ordrin.trayItemTemplate='<li class="trayItem" data-listener="editTrayItem" data-miid="{{itemId}}" data-tray-id="{{trayItemId}}"><div class="trayItemRemove" data-listener="removeTrayItem">X</div><span class="trayItemName">{{itemName}}</span><span class="trayItemPrice">{{price}}</span><span class="trayItemQuantity">({{quantity}})</span><ul>{{#options}}<li class="trayOption"><span class="trayOptionName">{{name}}</span><span class="trayOptionPrice">{{price}}</span></li>{{/options}}</ul></li>');var e="undefined"!=typeof module&&module.exports||{};(function(e){function t(e){return(""+e).replace(/&(?!\w+;)|[<>"']/g,function(e){return b[e]||e})}function n(e,t,n,r){for(var r=r||"<template>",i=t.split("\n"),s=Math.max(n-3,0),o=Math.min(i.length,n+3),i=i.slice(s,o),u=0,a=i.length;u<a;++u)o=u+s+1,i[u]=(o===n?" >> ":"    ")+i[u];return e.template=t,e.line=n,e.file=r,e.message=[r+":"+n,i.join("\n"),"",e.message].join("\n"),e}function r(e,t,n){if("."===e)return t[t.length-1];for(var e=e.split("."),r=e.length-1,i=e[r],s,o,u=t.length,a,f;u;){f=t.slice(0),o=t[--u];for(a=0;a<r;){o=o[e[a++]];if(null==o)break;f.push(o)}if(o&&"object"==typeof o&&i in o){s=o[i];break}}return"function"==typeof s&&(s=s.call(f[f.length-1])),null==s?n:s}function i(e,t,n,i){var s="",e=r(e,t);if(i){if(null==e||!1===e||p(e)&&0===e.length)s+=n()}else if(p(e))d(e,function(e){t.push(e),s+=n(),t.pop()});else if("object"==typeof e)t.push(e),s+=n(),t.pop();else if("function"==typeof e)var o=t[t.length-1],s=s+(e.call(o,n(),function(e){return a(e,o)})||"");else e&&(s+=n());return s}function s(t,r){for(var r=r||{},i=r.tags||e.tags,s=i[0],o=i[i.length-1],u=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],a=[],f=!1,l=!1,c=function(){if(f&&!l&&!r.space)for(;a.length;)u.splice(a.pop(),1);else a=[];l=f=!1},h=[],p,d,g,y=function(e){i=m(e).split(/\s+/),d=i[0],g=i[i.length-1]},b=function(e){u.push('";',p,'\nvar partial = partials["'+m(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},w=function(e,i){var s=m(e);if(""===s)throw n(Error("Section name may not be empty"),t,N,r.file);h.push({name:s,inverted:i}),u.push('";',p,'\nvar name = "'+s+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},E=function(e){w(e,!0)},S=function(e){var e=m(e),i=0!=h.length&&h[h.length-1].name;if(!i||e!=i)throw n(Error('Section named "'+e+'" was never opened'),t,N,r.file);e=h.pop(),u.push('";',"\n    return buffer;","\n  };","\n})();"),e.inverted?u.push("\nbuffer += renderSection(name,stack,callback,true);"):u.push("\nbuffer += renderSection(name,stack,callback);"),u.push('\nbuffer += "')},x=function(e){u.push('";',p,'\nbuffer += lookup("'+m(e)+'",stack,"");','\nbuffer += "')},T=function(e){u.push('";',p,'\nbuffer += escapeHTML(lookup("'+m(e)+'",stack,""));','\nbuffer += "')},N=1,C,k,L=0,A=t.length;L<A;++L)if(t.slice(L,L+s.length)===s){L+=s.length,C=t.substr(L,1),p="\nline = "+N+";",d=s,g=o,f=!0;switch(C){case"!":L++,k=null;break;case"=":L++,o="="+o,k=y;break;case">":L++,k=b;break;case"#":L++,k=w;break;case"^":L++,k=E;break;case"/":L++,k=S;break;case"{":o="}"+o;case"&":L++,l=!0,k=x;break;default:l=!0,k=T}C=t.indexOf(o,L);if(-1===C)throw n(Error('Tag "'+s+'" was not closed properly'),t,N,r.file);s=t.substring(L,C),k&&k(s);for(k=0;~(k=s.indexOf("\n",k));)N++,k++;L=C+o.length-1,s=d,o=g}else switch(C=t.substr(L,1),C){case'"':case"\\":l=!0,u.push("\\"+C);break;case"\r":break;case"\n":a.push(u.length),u.push("\\n"),c(),N++;break;default:v.test(C)?a.push(u.length):l=!0,u.push(C)}if(0!=h.length)throw n(Error('Section "'+h[h.length-1].name+'" was not closed properly'),t,N,r.file);return c(),u.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }"),o=u.join("").replace(/buffer \+= "";\n/g,""),r.debug&&("undefined"!=typeof console&&console.log?console.log(o):"function"==typeof print&&print(o)),o}function o(e,o){var u=s(e,o),f=new Function("view,partials,stack,lookup,escapeHTML,renderSection,render",u);return function(s,u){var u=u||{},l=[s];try{return f(s,u,l,r,t,i,a)}catch(c){throw n(c.error,e,c.line,o.file)}}}function u(e,t){return t=t||{},!1!==t.cache?(w[e]||(w[e]=o(e,t)),w[e]):o(e,t)}function a(e,t,n){return u(e)(t,n)}e.name="mustache.js",e.version="0.5.0-dev",e.tags=["{{","}}"],e.parse=s,e.compile=u,e.render=a,e.clearCache=function(){w={}},e.to_html=function(e,t,n,r){e=a(e,t,n);if("function"!=typeof r)return e;r(e)};var f=Object.prototype.toString,l=Array.isArray,c=Array.prototype.forEach,h=String.prototype.trim,p;p=l?l:function(e){return"[object Array]"===f.call(e)};var d;d=c?function(e,t,n){return c.call(e,t,n)}:function(e,t,n){for(var r=0,i=e.length;r<i;++r)t.call(n,e[r],r,e)};var v=/^\s*$/,m;if(h)m=function(e){return null==e?"":h.call(e)};else{var g,y;v.test("Â ")?(g=/^\s+/,y=/\s+$/):(g=/^[\s\xA0]+/,y=/[\s\xA0]+$/),m=function(e){return e==null?"":(""+e).replace(g,"").replace(y,"")}}var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},w={}})(e),ordrin.Mustache=e})();var ordrin=ordrin instanceof Object?ordrin:{};(function(){"use strict";function s(e,t,n){if(t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent){var r=t.attachEvent("on"+e,n);return r}}function o(e,t){var n=new RegExp("\\b"+t+"\\b");if(e.className.match(n)===null){while(e.parentNode!==document){e=e.parentNode;if(e.className.match(n)===null)continue;break}return e}return e}function u(e){while(e.firstChild)e.removeChild(e.firstChild)}function a(e){var t={},n;for(var r=0;r<e.length;r++){n=e[r],t[n.id]=n;if(typeof n.children!="undefined"){var i=a(n.children);for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}else n.children=!1;typeof n.descrip=="undefined"&&(n.descrip="")}return t}function l(e){typeof e.srcElement=="undefined"&&(e.srcElement=e.target);var t={menuItem:p,editTrayItem:d,closeDialog:g,addToTray:S,removeTrayItem:y,optionCheckbox:b},n=e.srcElement;while(!n.hasAttribute("data-listener")){n=n.parentNode;if(n===null)return}var r=n.getAttribute("data-listener");typeof t[r]!="undefined"&&t[r](n)}function c(e,t){var n=new RegExp("\\b"+t+"\\b");for(var r=0;r<e.children.length;r++)if(n.test(e.children[r].className))return e.children[r]}function h(e,t){if(typeof e.getElementsByClassName!="undefined")return e.getElementsByClassName(t);var n=new RegExp("\\b"+t+"\\b"),r=[];for(var i=0;i<e.children.length;i++){var s=e.children[i];n.test(s.className)&&r.push(s),r=r.concat(h(s,t))}return r}function p(e){var t=e.getAttribute("data-miid");v(t),m()}function d(t){var n=t.getAttribute("data-miid"),r=t.getAttribute("data-tray-id"),i=ordrin.tray.items[r];v(n);var s=h(e.dialog,"option");for(var o=0;o<s.length;o++){var u=s[o].getAttribute("data-moid"),a=h(s[o],"optionCheckbox")[0];a.checked=i.hasOptionSelected(u)}var f=h(e.dialog,"buttonRed")[0];f.setAttribute("value","Save to Tray");var l=h(e.dialog,"itemQuantity")[0];l.setAttribute("value",i.quantity),e.dialog.setAttribute("data-tray-id",r),m()}function v(t){e.dialog.innerHTML=ordrin.Mustache.render(ordrin.dialogTemplate,f[t]),e.dialog.setAttribute("data-miid",t)}function m(){e.dialogBg.className=e.dialogBg.className.replace("hidden",""),e.dialog.className=e.dialog.className.replace("hidden","")}function g(){e.dialogBg.className+=" hidden",u(e.dialog),e.dialog.removeAttribute("data-tray-id")}function y(e){var t=o(e,"trayItem");ordrin.tray.removeItem(t.getAttribute("data-tray-id"))}function b(e){var t=o(e,"optionCategory");w(t)}function w(e){var t=f[e.getAttribute("data-mogid")],n=+t.min_child_select,r=+t.max_child_select,i=h(e,"optionCheckbox"),s=0,o=c(e,"error");u(o);for(var a=0;a<i.length;a++)i[a].checked&&s++;if(s<n){p=!0;var l="You must select at least "+n+" options",p=document.createTextNode(l);return o.appendChild(p),!1}if(r>0&&s>r){p=!0;var l="You must select at most "+r+" options",p=document.createTextNode(l);return o.appendChild(p),!1}return!0}function E(){var n=e.dialog.getAttribute("data-miid"),i=h(e.dialog,"itemQuantity")[0].value;i<1&&(i=1);var s=!1,u=h(e.dialog,"optionCategory");for(var a=0;a<u.length;a++)w(u[a])||(s=!0);if(s)return;var l=[],c=h(e.dialog,"optionCheckbox");for(var a=0;a<c.length;a++)if(c[a].checked){var p=o(c[a],"option"),d=p.getAttribute("data-moid"),v=f[d].name,m=f[d].price,g=new t(d,v,m);l.push(g)}var y=f[n].name,b=f[n].price,E=new r(n,i,l,y,b);return e.dialog.hasAttribute("data-tray-id")&&(E.trayItemId=+e.dialog.getAttribute("data-tray-id")),E}function S(){var e=E();ordrin.tray.addItem(e),g()}function x(){var t=document.getElementById("ordrinMenu");e.dialog=h(t,"optionsDialog")[0],e.dialogBg=h(t,"dialogBg")[0],e.tray=h(t,"tray")[0]}ordrin.hasOwnProperty("render")||(ordrin.render=!0);var e={},t=function(e,t,n){this.id=e,this.name=t,this.price=n},n=0,r=function(e,t,r,i,s){this.trayItemId=n++,this.itemId=e,this.itemName=i,this.quantity=t,this.options=r,this.price=s,this.buildItemString=function(){var e=this.itemId+"/"+this.quantity;for(var t=0;t<this.options.length;t++)e+=","+this.options[t].id;return e},this.renderTrayHtml=function(){if(typeof this.trayItemNode=="undefined"){var e=ordrin.Mustache.render(ordrin.trayItemTemplate,this),t=document.createElement("div");t.innerHTML=e,this.trayItemNode=t.firstChild}return this.trayItemNode},this.hasOptionSelected=function(e){for(var t=0;t<r.length;t++)if(r[t].id==e)return!0;return!1},this.getTotalPrice=function(){var e=+this.price;for(var t=0;t<this.options.length;t++)e+=+this.options[t].price;return e*+this.quantity}},i=function(){this.items={},this.addItem=function(t){if(!(t instanceof r))throw new Error("Item must be an object of the Tray Item class");this.items[t.trayItemId]=t;var n=t.renderTrayHtml(),i=h(e.tray,"trayItem");for(var s=0;s<i.length;s++)if(+i[s].getAttribute("data-tray-id")===t.trayItemId){e.tray.replaceChild(n,i[s]);return}e.tray.appendChild(n)},this.removeItem=function(t){var n=this.items[t];delete this.items[t],e.tray.removeChild(n.trayItemNode)},this.buildTrayString=function(){var e="";for(var t in this.items)this.items.hasOwnProperty(t)&&(e+="+"+this.items[t].buildItemString());return e.substring(1)},this.getSubtotal=function(){var e=0;for(var t in this.items)this.items.hasOwnProperty(t)&&(e+=this.items[t].getTotalPrice());return e}};ordrin.tray=new i,ordrin.getTrayString=function(){return this.tray.buildTrayString()};var f={};s("DOMContentLoaded",window,function(){f=a(ordrin.menu);if(ordrin.render){var e=ordrin.Mustache.render(ordrin.template,ordrin);document.getElementById("ordrinMenu").innerHTML=e,x()}s("click",document,l)})})();