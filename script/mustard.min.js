var ordrin=typeof ordrin=="undefined"?{}:ordrin;(function(){"use strict";function l(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(e){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return alert("This browser is not AJAX enabled."),null}}}function c(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function h(e){return encodeURIComponent(e).replace("%20","+")}function p(e){return Object.keys(e).map(function(t){return Array.isArray(e[t])?e[t].map(function(e){return h(c(t))+"="+h(c(e))}):h(c(t))+"="+h(c(e[t]))}).join("&")}function d(e){return(e+"").length==1&&(e="0"+(e+"")),e}var e,t,n,r,i,s,o,u,a,f;e=function(){this.makeApiRequest=function(e,t,n,r,i){r=p(r);var s=l();s.open(n,e+t,!1),n!="GET"&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(r);if(s.status!==200){i({error:s.status,msg:s.statusText},null);return}i(null,JSON.parse(s.response))},this.buildUriString=function(e,t){for(var n=0;n<t.length;n++)e+="/"+encodeURIComponent(t[n]);return e}},t=function(t){var n=new e;this.getDeliveryList=function(e,t,n){e=this.checkDateTime(e);var r=[e,t.zip,t.city,t.addr];this.makeRestaurantRequest("/dl",r,{},"GET",n)},this.getDeliveryCheck=function(e,t,n,r){t=this.checkDateTime(t);var i=[e,t,n.zip,n.city,n.addr];this.makeRestaurantRequest("/dc",i,{},"GET",r)},this.getFee=function(e,t,n,r,i,s){r=this.checkDateTime(r);var o=[e,t,n,r,i.zip,i.city,i.addr];this.makeRestaurantRequest("/fee",o,{},"GET",s)},this.getDetails=function(e,t){this.makeRestaurantRequest("/rd",[e],{},"GET",t)},this.makeRestaurantRequest=function(e,r,i,s,o){var u=n.buildUriString(e,r);n.makeApiRequest(t,u,s,i,o)},this.checkDateTime=function(e){if(e!="ASAP"){var t=e.getMonth()+1+""+"-"+(e.getDate()+""),n=e.getHours()+":"+e.getMinutes();e=t+"+"+n}return e}},n=function(e,t){this.field=e,this.msg=t},r=function(e,t,n){Error.apply(this,arguments),this.fields={},this.addFields=function(e){for(var t=0;t<e.length;t++)this.fields[e[t].field]=e[t].msg}},i=function(t){var n=new e;this.placeOrder=function(e,r,i,s,o,u,a,f,l,c){var h=[e];s=s.toUpperCase();var p,d;s!=="ASAP"?(p=s.getMonth()+1+""+"-"+(s.getDate()+""),d=s.getHours()+":"+s.getMinutes()):(p="ASAP",d="");var v={tray:r.buildTrayString(),tip:i,delivery_date:p,delivery_time:d,first_name:o,last_name:u,addr:a.addr,city:a.city,state:a.state,zip:a.zip,phone:a.phone,card_name:f.name,card_number:f.number,card_cvc:f.cvc,card_expiry:f.formatExpirationDate(),card_bill_addr:f.billAddress.addr,card_bill_addr2:f.billAddress.addr2,card_bill_city:f.billAddress.city,card_bill_state:f.billAddress.state,card_bill_zip:f.billAddress.zip,em:l,type:"res"},m=n.buildUriString("/o",h);n.makeApiRequest(t,m,"POST",v,c)}},s=function(e,t,i,s,o,u){this.addr=e,this.city=t,this.state=i,this.zip=s,this.phone=(o+"").replace(/[^\d]/g,""),this.addr2=u,this.validate=function(){var e=[];/^[A-Z]{2}$/.test(this.state)==0&&e.push(new n("state","Invalid State format. It should be two upper case letters.")),/^\d{5}$/.test(this.zip)==0&&e.push(new n("zip","Invalid Zip code. Should be 5 numbers")),this.formatPhoneNumber(),this.phone.length!=12&&e.push(new n("phone","Invalid Phone number. Should be 10 digits"));if(e.length!=0){var t=new r("Validation Error","Check field errors for more details");throw t.addFields(e),t}},this.formatPhoneNumber=function(){this.phone=this.phone.substring(0,3)+"-"+this.phone.substring(3,6)+"-"+this.phone.substring(6)},this.validate()},o=function(e,t,i,s,o,u){this.name=e,this.expiryMonth=d(t),this.expiryYear=i,this.billAddress=s,this.number=o+"",this.cvc=u,this.validate=function(){var e=[];this.checkLuhn()||e.push(new n("number","Invalid Credit Card Number")),this.type=this.creditCardType();var t=/^\d{3}$/;this.type=="amex"&&(t=/^\d{4}$/),t.test(this.cvc)==0&&e.push(new n("cvc","Invalid cvc")),/^\d{4}$/.test(this.expiryYear)==0&&e.push(new n("expiryYear","Expiration Year must be 4 digits")),/^\d{2}$/.test(this.expiryMonth)==0&&e.push(new n("expiryMonth","Expiration Month must be 2 digits")),this.name.length==0&&e.push(new n("name","Name can not be blank"));if(e.length!=0){var i=new r("Validation Error","Check fields object for more details");throw i.addFields(e),i}},this.checkLuhn=function(){var e=[0,2,4,6,8,1,3,5,7,9];this.number=this.number.replace(/[^\d]/g,"");var t=this.number.split(""),n=!1,r=0;while(t.length){var i=Number(t.pop());r+=n?e[i]:i,n=!n}return r%10==0},this.creditCardType=function(){var e={visa:/^(4\d{12})|(4\d{15})$/,mastercard:/^5[1-5]\d{14}$/,discover:/^6011\d{12}$/,amex:/^3[47]\d{13}$/,diners:/^(30[0-5]\d{11})|(3[68]\d{12})$/};for(var t in e)if(e[t].test(this.number))return t;return"unknown"},this.formatExpirationDate=function(){return this.expiryMonth+"/"+this.expiryYear},this.validate()},u=function(e,t,n){this.itemId=e,this.quantity=t,this.options=n,this.buildItemString=function(){var e=this.itemId+"/"+this.quantity;return e+=","+this.options.join(","),e}},a=function(e){this.items=e,this.buildTrayString=function(){var e="";for(var t=0;t<this.items.length;t++)e+="+"+this.items[t].buildItemString();return e.substring(1)}},f=function(){return{restaurant:new t(ordrin.restaurantUrl),order:new i(ordrin.orderUrl),Address:s,CreditCard:o,TrayItem:u,Tray:a}},ordrin.api=f()})(),ordrin=ordrin instanceof Object?ordrin:{},function(){var e;ordrin.hasOwnProperty("template")||(ordrin.template='<div id="yourTray">Your Tray</div><ul class="menuList">{{#menu}}<li class="menuCategory" data-mgid="{{id}}"><div class="menu-hd"><p class="header itemListName">{{name}}</p></div><ul class="itemList menu main-menu">{{#children}}<li class="mi" data-listener="menuItem" data-miid="{{id}}"><p class="name">{{name}}</p><p><span class="price">{{price}}</span></p></li>{{/children}}</ul></li>{{/menu}}</ul><div class="trayContainer"><ul class="tray"></ul><div class="subtotal">Subtotal: <span class="subtotalValue">0.00</span></div><div class="tip">Tip: <span class="tipValue">0.00</span><input type="number" min="0.00" step="0.01" value="0.00" class="tipInput"><input type="button" value="Update" data-listener="updateTray"></div><div class="fee">Fee: <span class="feeValue">0.00</span></div><div class="tax">Tax: <span class="taxValue">0.00</span></div><div class="total">Total: <span class="totalValue">0.00</span></div><div class="addressForm"><form name="ordrinAddress"><label>Street Address 1: <input type="text" name="addr" placeholder="Street Address 1"></label><span class="addrError"></span></br><label>Street Address 2: <input type="text" name="addr2" placeholder="Street Address 2"></label><span class="addr2Error"></span></br><label>City: <input type="text" name="city" placeholder="City"></label><span class="cityError"></span></br><label>State: <input type="text" name="state" placeholder="State"></label><span class="stateError"></span></br><label>Zip Code: <input type="text" name="zip" placeholder="Zip Code"></label><span class="zipError"></span></br><label>Phone Number: <input type="tel" name="phone" placeholder="Phone Number"></label><span class="phoneError"></span></br><input type="button" value="Update" data-listener="updateAddress"></form></div></div><!-- Menu Item Dialog --><div class="optionsDialog popup-container hidden"></div><div class="dialogBg fade-to-gray hidden"></div><div class="errorDialog popup-container hidden"><div class="dialog popup-box-container"><div class="close-popup-box"><img class="closeDialog" data-listener="closeError" src="https://fb.ordr.in/images/popup-close.png" /></div><span class="errorMsg"></span></div></div><div class="errorBg fade-to-gray hidden"></div>'),ordrin.hasOwnProperty("dialogTemplate")||(ordrin.dialogTemplate='<div class="popup-box-container dialog"><div class="close-popup-box"><img class="closeDialog" data-listener="closeDialog" src="https://fb.ordr.in/images/popup-close.png" /></div><div class="mItem-add-to-tray popup-content"><div class="menu-hd"><div class="boxright"><h1 class="big-col itemTitle">{{name}}</h1><p class="slim-col itemPrice">{{price}}</p></div><div class="clear"></div></div><p class="desc dialogDescription">{{descrip}}</p></div><div class="optionContainer"><ul class="optionCategoryList">{{#children}}<li data-mogid="{{id}}" class="optionCategory"><span class="header">{{name}}</span><span class="error"></span><ul class="optionList">{{#children}}<li class="option" data-moid="{{id}}"><input type="checkbox" class="optionCheckbox" data-listener="optionCheckbox" /><span class="optionName">{{name}}</span><span class="optionPrice">{{price}}</span></li>{{/children}}</ul><div class="clear"></div></li>{{/children}}</ul>      </div><label for="itemQuantity">Quantity: </label><input type="number" class="itemQuantity" value="1" min="1" /><br /><input type="submit" class="buttonRed" data-listener="addToTray" value="Add to Tray" /></div>'),ordrin.hasOwnProperty("trayItemTemlate")||(ordrin.trayItemTemplate='<li class="trayItem" data-listener="editTrayItem" data-miid="{{itemId}}" data-tray-id="{{trayItemId}}"><div class="trayItemRemove" data-listener="removeTrayItem">X</div><span class="trayItemName">{{itemName}}</span><span class="trayItemPrice">{{quantityPrice}}</span><span class="trayItemQuantity">({{quantity}})</span><ul>{{#options}}<li class="trayOption"><span class="trayOptionName">{{name}}</span><span class="trayOptionPrice">{{totalPrice}}</span></li>{{/options}}</ul></li>'),ordrin.hasOwnProperty("restaurantsTemplate")||(ordrin.restaurantsTemplate='<article><ul>{{#restaurants}}<li><section><h1><a href="{{#params}}{{menu_uri}}{{/params}}/{{id}}{{#params}}?time={{dateTime}}&addr={{addr}}&city={{city}}&state={{state}}&zip={{zip}}&phone={{phone}}&addr2={{addr2}}{{/params}}">{{na}}</a></h1><p>{{ad}}</p><p>Expected delivery time: {{del}} minutes</p><p>Minimum order amount: ${{mino}}</p><ul>{{#cu}}<li>{{.}}</li>{{/cu}}</ul><p>This restaurant will{{^is_delivering}} <b>not</b>{{/is_delivering}} deliver to this address at this time</p></section></li>{{/restaurants}}</ul></article>'),e="undefined"!=typeof module&&module.exports||{},function(e){function p(e){return(""+e).replace(/&(?!\w+;)|[<>"']/g,function(e){return c[e]||e})}function d(e,t,n,r){var r,i,s,o,u,a;for(r=r||"<template>",i=t.split("\n"),s=Math.max(n-3,0),o=Math.min(i.length,n+3),i=i.slice(s,o),u=0,a=i.length;u<a;++u)o=u+s+1,i[u]=(o===n?" >> ":"    ")+i[u];return e.template=t,e.line=n,e.file=r,e.message=[r+":"+n,i.join("\n"),"",e.message].join("\n"),e}function v(e,t,n){var e,r,i,s,o,u,a,f;if("."===e)return t[t.length-1];for(e=e.split("."),r=e.length-1,i=e[r],u=t.length;u;){f=t.slice(0),o=t[--u];for(a=0;a<r;){o=o[e[a++]];if(null==o)break;f.push(o)}if(o&&"object"==typeof o&&i in o){s=o[i];break}}return"function"==typeof s&&(s=s.call(f[f.length-1])),null==s?n:s}function m(e,t,n,r){var i,u="",e=v(e,t);if(r){if(null==e||!1===e||s(e)&&0===e.length)u+=n()}else s(e)?o(e,function(e){t.push(e),u+=n(),t.pop()}):"object"==typeof e?(t.push(e),u+=n(),t.pop()):"function"==typeof e?(i=t[t.length-1],u+=e.call(i,n(),function(e){return w(e,i)})||""):e&&(u+=n());return u}function g(t,n){var n,r,i,s,o,f,l,c,h,p,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;for(n=n||{},r=n.tags||e.tags,i=r[0],s=r[r.length-1],o=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],f=[],l=!1,c=!1,h=function(){if(l&&!c&&!n.space)for(;f.length;)o.splice(f.pop(),1);else f=[];c=l=!1},p=[],y=function(e){r=a(e).split(/\s+/),m=r[0],g=r[r.length-1]},b=function(e){o.push('";',v,'\nvar partial = partials["'+a(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},w=function(e,r){var i=a(e);if(""===i)throw d(Error("Section name may not be empty"),t,N,n.file);p.push({name:i,inverted:r}),o.push('";',v,'\nvar name = "'+i+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},E=function(e){w(e,!0)},S=function(e){var e=a(e),r=0!=p.length&&p[p.length-1].name;if(!r||e!=r)throw d(Error('Section named "'+e+'" was never opened'),t,N,n.file);e=p.pop(),o.push('";',"\n    return buffer;","\n  };","\n})();"),e.inverted?o.push("\nbuffer += renderSection(name,stack,callback,true);"):o.push("\nbuffer += renderSection(name,stack,callback);"),o.push('\nbuffer += "')},x=function(e){o.push('";',v,'\nbuffer += lookup("'+a(e)+'",stack,"");','\nbuffer += "')},T=function(e){o.push('";',v,'\nbuffer += escapeHTML(lookup("'+a(e)+'",stack,""));','\nbuffer += "')},N=1,L=0,A=t.length;L<A;++L)if(t.slice(L,L+i.length)===i){L+=i.length,C=t.substr(L,1),v="\nline = "+N+";",m=i,g=s,l=!0;switch(C){case"!":L++,k=null;break;case"=":L++,s="="+s,k=y;break;case">":L++,k=b;break;case"#":L++,k=w;break;case"^":L++,k=E;break;case"/":L++,k=S;break;case"{":s="}"+s;case"&":L++,c=!0,k=x;break;default:c=!0,k=T}C=t.indexOf(s,L);if(-1===C)throw d(Error('Tag "'+i+'" was not closed properly'),t,N,n.file);i=t.substring(L,C),k&&k(i);for(k=0;~(k=i.indexOf("\n",k));)N++,k++;L=C+s.length-1,i=m,s=g}else switch(C=t.substr(L,1),C){case'"':case"\\":c=!0,o.push("\\"+C);break;case"\r":break;case"\n":f.push(o.length),o.push("\\n"),h(),N++;break;default:u.test(C)?f.push(o.length):c=!0,o.push(C)}if(0!=p.length)throw d(Error('Section "'+p[p.length-1].name+'" was not closed properly'),t,N,n.file);return h(),o.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }"),s=o.join("").replace(/buffer \+= "";\n/g,""),n.debug&&("undefined"!=typeof console&&console.log?console.log(s):"function"==typeof print&&print(s)),s}function y(e,t){var n=g(e,t),r=Function("view,partials,stack,lookup,escapeHTML,renderSection,render",n);return function(n,i){var i=i||{},s=[n];try{return r(n,i,s,v,p,m,w)}catch(o){throw d(o.error,e,o.line,t.file)}}}function b(e,t){return t=t||{},!1!==t.cache?(h[e]||(h[e]=y(e,t)),h[e]):y(e,t)}function w(e,t,n){return b(e)(t,n)}var t,n,r,i,s,o,u,a,f,l,c,h;e.name="mustache.js",e.version="0.5.0-dev",e.tags=["{{","}}"],e.parse=g,e.compile=b,e.render=w,e.clearCache=function(){h={}},e.to_html=function(e,t,n,r){e=w(e,t,n);if("function"!=typeof r)return e;r(e)},t=Object.prototype.toString,n=Array.isArray,r=Array.prototype.forEach,i=String.prototype.trim,s=n?n:function(e){return"[object Array]"===t.call(e)},o=r?function(e,t,n){return r.call(e,t,n)}:function(e,t,n){var r,i;for(r=0,i=e.length;r<i;++r)t.call(n,e[r],r,e)},u=/^\s*$/,i?a=function(e){return null==e?"":i.call(e)}:(u.test(" ")?(f=/^\s+/,l=/\s+$/):(f=/^[\s\xA0]+/,l=/[\s\xA0]+$/),a=function(e){return e==null?"":(""+e).replace(f,"").replace(l,"")}),c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},h={}}(e),ordrin.Mustache=e}(),ordrin=ordrin instanceof Object?ordrin:{},function(){"use strict";function o(){this.getTray=function(){return ordrin.tray},this.setAddress=function(e){ordrin.address=e,g(),this.deliveryCheck()},this.deliveryCheck=function(){ordrin.api.restaurant.getDeliveryCheck(ordrin.rid,ordrin.deliveryTime,ordrin.address,function(e,t){e?l(e):(console.log(t),ordrin.delivery=t.delivery,t.delivery===0&&l(t))})},this.getRid=function(){return ordrin.rid},this.getAddress=function(){return ordrin.address},this.setDeliveryTime=function(e){ordrin.deliveryTime=e},this.getDeliveryTime=function(){return ordrin.deliveryTime},this.getTip=function(){return ordrin.tip},this.downloadMenu=function(e){return ordrin.api.restaurant.getDetails(e,function(e,t){ordrin.menu=t.menu}),ordrin.menu},this.downloadRestaurants=function(e,t){ordrin.api.restaurant.getDeliveryList(e,t,function(e,t){var n;ordrin.restaurants=t;for(n=0;n<ordrin.restaurants.length;n++)ordrin.restaurants[n].is_delivering=!!ordrin.restaurants[n].is_delivering})},this.renderMenu=function(){var e=ordrin.Mustache.render(ordrin.template,ordrin);document.getElementById("ordrinMenu").innerHTML=e,D()},this.renderRestaurants=function(){var e,t,n,r={};for(e in ordrin.address)ordrin.address.hasOwnProperty(e)&&(r[e]=encodeURIComponent(ordrin.address[e]));r.dateTime=ordrin.deliveryTime,console.log(r);for(t=0;t<ordrin.restaurants.length;t++)ordrin.restaurants[t].params=r;n=ordrin.Mustache.render(ordrin.restaurantsTemplate,ordrin),document.getElementById("ordrinRestaurants").innerHTML=n}}function u(e){var t;if(e.indexOf(".")<0)return+e*100;t=e.match(/(\d*)\.(\d{2})\d*$/);if(t)return+(t[1]+t[2]);t=e.match(/(\d*)\.(\d)$/);if(t)return+(t[1]+t[2])*10;console.log(e+" is not an amount of money")}function a(e){var t,n=e+"";while(n.length<3)n="0"+n;return t=n.length-2,n.substring(0,t)+"."+n.substring(t)}function f(){ordrin.tray.updateFee()}function l(e){typeof ordrin.callback=="function"?ordrin.callback(e):(console.log(e),typeof e=="object"&&typeof e.msg!="undefined"?c(e.msg):c(JSON.stringify(e)))}function c(t){e.errorBg.className=e.errorBg.className.replace("hidden",""),S(e.errorDialog,"errorMsg")[0].innerHTML=t,e.errorDialog.className=e.errorDialog.className.replace("hidden","")}function h(){e.errorBg.className+=" hidden",e.errorDialog.className+=" hidden",v(S(e.errorDialog,"errorMsg")[0])}function p(e,t,n){var r;if(t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent)return r=t.attachEvent("on"+e,n),r}function d(e,t){var n=RegExp("\\b"+t+"\\b");if(e.className.match(n)===null){while(e.parentNode!==document){e=e.parentNode;if(e.className.match(n)===null)continue;break}return e}return e}function v(e){while(e.firstChild)e.removeChild(e.firstChild)}function m(e){var t,n,r,i,s={};for(n=0;n<e.length;n++){t=e[n],s[t.id]=t;if(typeof t.children!="undefined"){r=m(t.children);for(i in r)r.hasOwnProperty(i)&&(s[i]=r[i])}else t.children=!1;typeof t.descrip=="undefined"&&(t.descrip="")}return s}function g(){var e;typeof ordrin.address!="undefined"&&(e=document.forms.ordrinAddress,e.addr.value=ordrin.address.addr||"",e.addr2.value=ordrin.address.addr2||"",e.city.value=ordrin.address.city||"",e.state.value=ordrin.address.state||"",e.zip.value=ordrin.address.zip||"",e.phone.value=ordrin.address.phone||"")}function y(){typeof ordrin.deliveryTime=="undefined"&&(ordrin.deliveryTime="ASAP"),typeof ordrin.rid!="undefined"&&(typeof ordrin.menu=="undefined"&&ordrin.mustard.downloadMenu(ordrin.rid),s=m(ordrin.menu),ordrin.render==="menu"?ordrin.mustard.renderMenu():D(),p("click",document,b),g(),ordrin.address&&ordrin.mustard.deliveryCheck()),ordrin.render==="restaurants"&&(typeof ordrin.restaurants=="undefined"&&ordrin.mustard.downloadRestaurants(ordrin.deliveryTime,ordrin.address),ordrin.mustard.renderRestaurants())}function b(e){var t,n,r;typeof e.srcElement=="undefined"&&(e.srcElement=e.target),t={menuItem:x,editTrayItem:T,closeDialog:k,addToTray:_,removeTrayItem:L,optionCheckbox:A,updateTray:f,updateAddress:w,closeError:h},n=e.srcElement;while(!n.hasAttribute("data-listener")){if(n.tagName.toUpperCase()==="HTML")return;n=n.parentNode}r=n.getAttribute("data-listener"),typeof t[r]!="undefined"&&t[r](n)}function w(){var t,n,r,i=document.forms.ordrinAddress,s=["addr","addr2","city","state","zip","phone"];for(t=0;t<s.length;t++)S(e.menu,s[t]+"Error")[0].innerHTML="";try{n=new ordrin.api.Address(i.addr.value,i.city.value,i.state.value,i.zip.value,i.phone.value,i.addr2.value),ordrin.mustard.setAddress(n)}catch(o){console.log(o);if(typeof o.fields!="undefined"){r=Object.keys(o.fields);for(t=0;t<r.length;t++)S(e.menu,r[t]+"Error")[0].innerHTML=o.fields[r[t]]}}}function E(e,t){var n,r=RegExp("\\b"+t+"\\b");for(n=0;n<e.children.length;n++)if(r.test(e.children[n].className))return e.children[n]}function S(e,t){var n,r,i,s;if(typeof e.getElementsByClassName!="undefined")return e.getElementsByClassName(t);n=RegExp("\\b"+t+"\\b"),r=[];for(i=0;i<e.children.length;i++)s=e.children[i],n.test(s.className)&&r.push(s),r=r.concat(S(s,t));return r}function x(e){var t=e.getAttribute("data-miid");N(t),C()}function T(t){var n,r,i,s,o,u,a=t.getAttribute("data-miid"),f=t.getAttribute("data-tray-id"),l=ordrin.tray.items[f];N(a),n=S(e.dialog,"option");for(r=0;r<n.length;r++)i=n[r].getAttribute("data-moid"),s=S(n[r],"optionCheckbox")[0],s.checked=l.hasOptionSelected(i);o=S(e.dialog,"buttonRed")[0],o.setAttribute("value","Save to Tray"),u=S(e.dialog,"itemQuantity")[0],u.setAttribute("value",l.quantity),e.dialog.setAttribute("data-tray-id",f),C()}function N(t){e.dialog.innerHTML=ordrin.Mustache.render(ordrin.dialogTemplate,s[t]),e.dialog.setAttribute("data-miid",t)}function C(){e.dialogBg.className=e.dialogBg.className.replace("hidden",""),e.dialog.className=e.dialog.className.replace("hidden","")}function k(){e.dialogBg.className+=" hidden",v(e.dialog),e.dialog.removeAttribute("data-tray-id")}function L(e){var t=d(e,"trayItem");ordrin.tray.removeItem(t.getAttribute("data-tray-id"))}function A(e){var t=d(e,"optionCategory");O(t)}function O(e){var t,n,r,i=s[e.getAttribute("data-mogid")],o=+i.min_child_select,u=+i.max_child_select,a=S(e,"optionCheckbox"),f=0,l=E(e,"error");v(l);for(t=0;t<a.length;t++)a[t].checked&&f++;return f<o?(r=!0,n="You must select at least "+o+" options",r=document.createTextNode(n),l.appendChild(r),!1):u>0&&f>u?(r=!0,n="You must select at most "+u+" options",r=document.createTextNode(n),l.appendChild(r),!1):!0}function M(){var n,i,o,u,a,f,l,c,h,p,v,m,g,y=e.dialog.getAttribute("data-miid"),b=S(e.dialog,"itemQuantity")[0].value;b<1&&(b=1),n=!1,i=S(e.dialog,"optionCategory");for(o=0;o<i.length;o++)O(i[o])||(n=!0);if(n)return;u=[],a=S(e.dialog,"optionCheckbox");for(o=0;o<a.length;o++)a[o].checked&&(f=d(a[o],"option"),l=f.getAttribute("data-moid"),c=s[l].name,h=s[l].price,p=new t(l,c,h),u.push(p));return v=s[y].name,m=s[y].price,g=new r(y,b,u,v,m),e.dialog.hasAttribute("data-tray-id")&&(g.trayItemId=+e.dialog.getAttribute("data-tray-id")),g}function _(){var e=M();ordrin.tray.addItem(e),k(),ordrin.delivery||l({msg:"The restaurant will not deliver to this address at the chosen time"})}function D(){var t=document.getElementById("ordrinMenu");e.menu=t,e.dialog=S(t,"optionsDialog")[0],e.dialogBg=S(t,"dialogBg")[0],e.errorDialog=S(t,"errorDialog")[0],e.errorBg=S(t,"errorBg")[0],e.tray=S(t,"tray")[0]}var e,t,n,r,i,s;ordrin.mustard=new o,ordrin.hasOwnProperty("render")||(ordrin.render=!0),e={},t=function(e,t,n){this.id=e,this.name=t,this.price=u(n)},n=0,r=function(e,t,r,i,s){this.trayItemId=n++,this.itemId=e,this.itemName=i,this.quantity=+t;for(var o=0;o<r.length;o++)r[o].totalPrice=a(r[o].price*this.quantity);this.options=r,this.price=u(s),this.quantityPrice=a(this.quantity*this.price),this.buildItemString=function(){var e=this.itemId+"/"+this.quantity;for(var t=0;t<this.options.length;t++)e+=","+this.options[t].id;return e},this.renderTrayHtml=function(){if(typeof this.trayItemNode=="undefined"){var e=ordrin.Mustache.render(ordrin.trayItemTemplate,this),t=document.createElement("div");t.innerHTML=e,this.trayItemNode=t.firstChild}return this.trayItemNode},this.hasOptionSelected=function(e){for(var t=0;t<r.length;t++)if(r[t].id==e)return!0;return!1},this.getTotalPrice=function(){var e=this.price;for(var t=0;t<this.options.length;t++)e+=this.options[t].price;return e*this.quantity}},i=function(){this.items={},this.addItem=function(t){if(!(t instanceof r))throw Error("Item must be an object of the Tray Item class");this.items[t.trayItemId]=t;var n=t.renderTrayHtml(),i=S(e.tray,"trayItem");for(var s=0;s<i.length;s++)if(+i[s].getAttribute("data-tray-id")===t.trayItemId){e.tray.replaceChild(n,i[s]),this.updateFee();return}e.tray.appendChild(n),this.updateFee()},this.removeItem=function(t){var n=this.items[t];delete this.items[t],e.tray.removeChild(n.trayItemNode),this.updateFee()},this.buildTrayString=function(){var e="";for(var t in this.items)this.items.hasOwnProperty(t)&&(e+="+"+this.items[t].buildItemString());return e.substring(1)},this.getSubtotal=function(){var e=0;for(var t in this.items)this.items.hasOwnProperty(t)&&(e+=this.items[t].getTotalPrice());return e},this.updateFee=function(){var t=this.getSubtotal();S(e.menu,"subtotalValue")[0].innerHTML=a(t);var n=u(S(e.menu,"tipInput")[0].value+"");ordrin.tip=n,S(e.menu,"tipValue")[0].innerHTML=a(n),ordrin.api.restaurant.getFee(ordrin.rid,a(this.getSubtotal()),a(n),ordrin.deliveryTime,ordrin.address,function(r,i){if(r)l(r);else{S(e.menu,"feeValue")[0].innerHTML=i.fee,S(e.menu,"taxValue")[0].innerHTML=i.tax;var s=t+n+u(i.fee)+u(i.tax);S(e.menu,"totalValue")[0].innerHTML=a(s),i.delivery===0&&l({delivery:0,msg:i.msg})}})}},ordrin.tray=new i,ordrin.getTrayString=function(){return this.tray.buildTrayString()},s={},y()}();